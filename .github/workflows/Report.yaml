name: "Report"

on:
  schedule:
    - cron: "55 21 * * 0" # Monday 05:55 CST
    - cron: "55 21 * * 1" # Tuesday 05:55 CST
    - cron: "55 21 * * 2" # Wednesday 05:55 CST
    - cron: "55 21 * * 3" # Thursday 05:55 CST
    - cron: "55 21 * * 4" # Friday 05:55 CST
    - cron: "55 21 * * 5" # Saturday 05:55 CST
    - cron: "55 21 * * 6" # Sunday 05:55 CST
  workflow_dispatch:
    inputs:
      task:
        type: choice
        required: true
        default: "none"
        options:
          - "none"
          - "bad-display-title"
          - "bad-file-name"
          - "broken-file-links"
          - "most-transcluded-pages"
          - "need-improve"
          - "need-improve-vtuber"
          - "need-improve-welcome"
          - "short-pages"
          - "tentative-title"

env:
  MOEGIRL_API_USER_AGENT: ${{ secrets.MOEGIRL_API_USER_AGENT }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  bad-display-title:
    if: |
      github.event.schedule == '55 21 * * 1' || 
      github.event.inputs.task == 'bad-display-title'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
        run: node src/Report/badDisplayTitle.js

  bad-file-name:
    if: |
      github.event.schedule == '55 21 * * 0' || 
      github.event.inputs.task == 'bad-file-name'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
          CM_IBOT: ${{ secrets.CM_IBOT }}
        run: node src/Report/badFileName.js

  broken-file-links:
    if: |
      github.event.schedule == '55 21 * * 6' || 
      github.event.inputs.task == 'broken-file-links'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
          CM_IBOT: ${{ secrets.CM_IBOT }}
        run: node src/Report/brokenFileLinks.js

  most-transcluded-pages:
    if: |
      github.event.schedule == '55 21 * * 1' || 
      github.event.inputs.task == 'most-transcluded-pages'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
        run: node src/Report/mostTranscludedPages.js

  need-improve:
    if: |
      github.event.schedule == '55 21 * * 4' || 
      github.event.inputs.task == 'need-improve'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
        run: node src/Report/needImprove.js
        
  need-improve-vtuber:
    runs-on: ubuntu-latest
    if: |
      github.event.schedule == '50 16 6 * *' ||
      github.event.inputs.task == 'need-improve-vtuber'
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script @7th
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
        run: node src/Report/needImproveVtuber.js

  need-improve-welcome:
    if: |
      github.event.schedule == '55 21 * * 4' || 
      github.event.inputs.task == 'need-improve-welcome'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
        run: node src/Report/needImproveWelcome.js

  short-pages:
    if: |
      github.event.schedule == '55 21 * * 2' || 
      github.event.inputs.task == 'short-pages'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
        run: node src/Report/shortPages.js

  tentative-title:
    if: |
      github.event.schedule == '55 21 * * 2' || 
      github.event.inputs.task == 'tentative-title'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set Node Version
        uses: actions/setup-node@v4
        with:
          node-version: 20.x
          cache: "npm"
      - name: Install dependencies
        run: npm ci
      - name: Run Script
        env:
          ZH_IBOT: ${{ secrets.ZH_IBOT }}
        run: node src/Report/tentativeTitle.js

  




  

  